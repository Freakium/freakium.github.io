!function(){let e=new bootstrap.Offcanvas("#itemForm"),t=4,a=flatpickr(".datepicker",{enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d, h:i K"});function l(e,t=!1){let a=0,l={};document.getElementById("item-list").innerHTML="",e.forEach(e=>{let n=e.weight?e.price*e.weight:e.price;t&&(l.hasOwnProperty(e.type)?l[e.type]++:l[e.type]=1),o(e.id,e.name,e.type,e.colour,e.quantity,e.date,n);let i=parseFloat(e.price),r=parseFloat(e.weight),s=parseInt(e.quantity);isNaN(i)||(a+=r?i*r*s:i*s)}),t&&s(l,"All"),c(),g(a)}function n(e){let t=0;document.querySelectorAll(".badge-price").forEach(e=>{let a=parseFloat(e.getAttribute("data-price")),l=parseInt(e.getAttribute("data-quantity"));isNaN(a)||(t+=a*l)}),e&&(t+=e),g(t)}function i(e=!1){!function e(t=!1){let a=api.fetchItems();if(!a&&t){r("messageArea","A problem occurred while loading file. Please make sure you are loading the correct inventory file.","danger",3);return}l(a,!0)}(e);let t;t=api.fetchTitle()??"Inventory",document.getElementById("inventoryTitle").value=t;let a;a=api.fetchCurrency()??"$",document.getElementById("currencySymbolSelect").value=a,u(a)}function r(e,t,a,l){if("string"!=typeof t||"string"!=typeof e||0==e.length)return;if(0===t.length){document.getElementById(e).innerHTML="<br>";return}let n=`<div class="alert alert-${a} alert-dismissible fade show d-flex shadow py-2" role="alert">
        <i class="${"success"===a?"bi bi-check-circle":"bi bi-exclamation-triangle"} me-2"></i><span class="fw-bold mx-auto text-center">${t}</span>
        <button type="button" class="btn-close pt-1" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;document.getElementById(e).innerHTML=n,l&&setTimeout(()=>{document.getElementById(e).innerHTML="<br>"},1e3*parseInt(l))}function s(e,t){let a="",l=0,n=Object.keys(e);n.sort(),n.forEach(t=>{l+=e[t],a+=`<button class="btn btn-sm btn-outline-primary position-relative typeListBtn" id="typeListBtn-${t}" onclick="typeFilter(this)"
            data-count="${e[t]}" data-name="${t}" data-bs-toggle="button">
          ${t}
          <span class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-secondary">${e[t]}</span>
        </button>`}),a=`<button class="btn btn-sm btn-outline-primary position-relative" id="typeListBtn-All" data-bs-toggle="button" onclick="typeFilter(this)">
        All
        ${l?`<span class="position-absolute top-0 start-50 translate-middle badge rounded-pill bg-secondary">${l}</span>`:""}
      </button>`+a,console.log(l),document.getElementById("type-list").innerHTML=a;let i=document.getElementById(`typeListBtn-${t}`);i?i.click():document.getElementById("typeListBtn-All").click()}function d(e,t,a){let l={},n="";switch(document.querySelectorAll(".typeListBtn").forEach(e=>{let t=e.getAttribute("data-name");l[t]=parseInt(e.getAttribute("data-count")),e.classList.contains("active")&&(n=t)}),e){case"delete":l.hasOwnProperty(t)&&(l[t]--,0===l[t]&&delete l[t]);break;case"update":l.hasOwnProperty(a)&&(l[a]--,0===l[a]&&delete l[a]);case"add":l.hasOwnProperty(t)?l[t]++:l[t]=1}s(l,n)}function o(e,t,a,l,n,i,r){let s=new Date(i),d=s.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),o=`<span class="currency-display" data-price="${r}">${y(r??0)}</span>`;document.getElementById("item-list").innerHTML+=`<div class="col" id="${e}">
        <div class="card shadow h-100">
          <div class="card-header d-flex fw-bold text-white justify-content-between" id="${e}-header" style="background-color: ${l}">
            <span class="d-flex align-items-center text-nowrap" id="${e}-itemName" title="Item Name">${t}</span>
            <div class="d-flex">
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}', true)" title="Duplicate"><i class="bi bi-copy"></i></button>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}')" title="Edit"><i class="bi bi-pencil-square"></i></button>
            </div>
          </div>
          <div class="card-body bg-secondary-subtle">
            <div class="d-flex justify-content-between mb-3">
              <span class="badge bg-primary" id="${e}-itemType" title="Item Type">${a}</span>
              <span class="badge bg-success badge-price${r?"":" d-none"}" id="${e}-itemPrice" data-price="${r??0}" data-quantity="${n}" title="Item Price">
                ${o}
              </span>
            </div>
            <div class="form-floating shadow">
              <input class="form-control" id="${e}-quantity" value="${n}" title="Quantity" disabled>
              <label for="floatingInput">Quantity</label>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-body-secondary" id="${e}-itemDate" title="Appointment Date">${d}</small>
          </div>
        </div>
      </div>`}function m(e){document.getElementById("itemFormHeader").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("itemFormHeader").classList.add(`bg-${e}-subtle`),document.getElementById("optionalHeaderBtn").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("optionalHeaderBtn").classList.add(`bg-${e}-subtle`)}function c(){let e=document.getElementById("addItemBtn");e&&e.remove(),document.getElementById("item-list").innerHTML+=`<div class="col" id="addItemBtn">
        <div class="card shadow h-100">
          <button class="btn btn-lg bg-body-tertiary text-primary h-100" title="Add Item" onclick="addItemMode();">
            <i class="bi bi-plus-square"></i>
          </button>
        </div>
      </div>`}function g(e){e?(document.getElementById("totalAmount").innerHTML=`<span class="currency-display" data-price="${e}">${y(e)}</span>`,document.getElementById("totalArea").classList.remove("d-none")):(document.getElementById("totalAmount").innerHTML="",document.getElementById("totalArea").classList.add("d-none"))}function y(e){let t=api.fetchCurrency()??"$",a="",l="";switch(t){case"$":a="en-US",l="USD";break;case"€":a="de-DE",l="EUR";break;case"\xa3":a="en-GB",l="GBP";break;case"\xa5":a="ja-JP",l="JPY";break;case"₩":a="ko-KR",l="KRW"}return e.toLocaleString(a,{style:"currency",currency:l})}function u(e){document.getElementById("currencySymbol").innerHTML=e,document.querySelectorAll(".currency-display").forEach(e=>{let t=parseFloat(e.getAttribute("data-price"));if(!isNaN(t)){let a=y(t);e.innerHTML=a}})}function I(){let e=parseFloat(document.getElementById("itemPrice").value),t=parseFloat(document.getElementById("itemWeight").value),a=parseInt(document.getElementById("itemQuantity").value),l=0;if(isNaN(e)||e<=0){document.getElementById("itemPriceTotal").innerHTML="";return}l=isNaN(t)||t<=0?e*(isNaN(a)||!a?1:a):e*t*(isNaN(a)||!a?1:a),document.getElementById("itemPriceTotal").innerHTML=`Total Price: ${y(l)}`}addEventListener("load",e=>{i(),window.matchMedia("(prefers-color-scheme: dark)").matches&&toggleTheme(),$("#item-list").sortable({items:".col:not('#addItemBtn')",opacity:.8,placeholder:"sortable-placeholder",tolerance:"pointer",stop:function(e,a){let l=a.item[0],n=api.fetchItems(),i=l.id,s=n.findIndex(e=>e.id.toString()===i);if(s>-1){let d=[...document.getElementById("item-list").querySelectorAll(".col")].indexOf(l);if(d===s)t?t--:(r("messageArea","If you are having issues scrolling on mobile, place your finger on an item's quantity box to scroll the page.","warning",8),t=4);else{let o=n.splice(s,1)[0];n.splice(d,0,o),api.updateItems(n),t=4}}else r("messageArea","Sorting error. Item not found.","danger",3)}})}),window.addEventListener("scroll",e=>{let t=document.getElementById("scrollToTop");t.style.display=window.scrollY>20?"block":"none"}),document.getElementById("itemForm").addEventListener("shown.bs.offcanvas",e=>{let t=document.getElementById("itemId").value;t||document.getElementById("itemName").focus();let a=bootstrap.Collapse.getInstance(document.getElementById("collapseOpt"));a&&a.show()}),document.getElementById("item-list").addEventListener("click",e=>{document.getElementById("navbarNav").classList.contains("show")&&document.getElementById("navbarNavHamburger").click()}),document.getElementById("formHelpModal").addEventListener("shown.bs.modal",e=>{document.getElementById("formHelpModal").focus()}),document.getElementById("formHelpModal").addEventListener("hidden.bs.modal",e=>{document.getElementById("itemForm").focus()}),document.getElementById("currencySymbolSelect").addEventListener("change",e=>{let t=e.target.value;api.editCurrency(t),u(t)}),document.getElementById("itemQuantity").addEventListener("change",e=>{I()}),document.getElementById("itemPrice").addEventListener("change",e=>{I()}),document.getElementById("itemWeight").addEventListener("change",e=>{I()}),window.clearData=()=>{document.getElementById("item-list").innerHTML="",localStorage.clear(),i();bootstrap.Modal.getInstance(document.getElementById("clearModal")).hide(),r("messageArea","Data cleared!","success",3)},window.loadFileListener=()=>{document.getElementById("fileInput").click()},window.loadFile=()=>{let t=document.getElementById("fileInput").files[0];if(t){let a=new FileReader;a.onload=t=>{let a=t.target.result;try{let l=JSON.parse(a);l.items?(r("messageArea",""),e.hide(),api.loadInventory(l),i(!0)):r("messageArea","Error loading file. Inventory data not found.","danger",3)}catch(n){console.error(n),r("messageArea","Error loading file. Could not read data.","danger",3)}},a.readAsText(t)}else r("messageArea","File not found.","danger",3)},window.saveFile=()=>{let e=api.fetchInventory();if(!e.items.length){r("messageArea","Save canceled. There are no items in the list.","danger",3);return}e.title||(e.title=document.getElementById("inventoryTitle").value),e.currency||(e.currency=document.getElementById("currencySymbolSelect").value);let t=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=document.getElementById("downloadLink");a.href=URL.createObjectURL(t),a.download="inventory.txt",a.click()},window.sortItems=e=>{if(!api.fetchItems().length){r("messageArea","There are no items to sort.","danger",3);return}document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")}),document.getElementById("typeListBtn-All").classList.add("active");let t;switch(e){case"1":t=api.sortItemsByName(!0);break;case"2":t=api.sortItemsByType();break;case"3":t=api.sortItemsByType(!0);break;case"4":t=api.sortItemsByDate();break;case"5":t=api.sortItemsByDate(!0);case"6":t=api.sortItemsByQuantity();break;case"7":t=api.sortItemsByQuantity(!0);break;case"8":t=api.sortItemsByPrice();break;case"9":t=api.sortItemsByPrice(!0);break;default:t=api.sortItemsByName()}l(t)},window.toggleTheme=()=>{let e=document.getElementById("themeBtn"),t=document.documentElement;t.hasAttribute("data-bs-theme")?(t.removeAttribute("data-bs-theme"),e.innerHTML='<i class="bi bi-moon-stars-fill mx-2"></i>Dark Mode'):(t.setAttribute("data-bs-theme","dark"),e.innerHTML='<i class="bi bi-brightness-high-fill mx-2"></i>Light Mode')},window.typeFilter=e=>{let t=document.getElementById("typeListBtn-All"),a=e.classList.contains("active");if("All"===e.getAttribute("data-name"))a?(l(api.fetchItems()),document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")})):e.classList.add("active");else{let n=document.querySelectorAll(".typeListBtn.active");if(n.length){let i=[];document.querySelectorAll(".typeListBtn.active").forEach(e=>{i.push(e.getAttribute("data-name"))});l(api.fetchItemsByType(i)),t.classList.remove("active")}else l(api.fetchItems()),t.classList.add("active")}},window.setTitle=e=>{e.value||(e.value="Inventory"),api.editTitle(e.value)},window.addItemMode=()=>{document.getElementById("itemOperation").innerHTML="Add",document.getElementById("itemId").value="",document.getElementById("itemName").value="",document.getElementById("itemType").value="",document.getElementById("itemColour").value="",document.getElementById("itemQuantity").value="",document.getElementById("itemPrice").value="",document.getElementById("itemWeight").value="",document.getElementById("itemWeightUnit").innerHTML="kg",document.getElementById("itemPriceTotal").innerHTML="",a.clear(),document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),m("success"),r("itemFormMessageArea",""),e.show()},window.updateItemMode=(t,l=!1)=>{var n,i,s,d;let o,c,g;n=t,i=l,(o=api.fetchItem(n)).id?(i&&(o.id=""),s=o,d=i,document.getElementById("itemOperation").innerHTML=d?"Duplicate":"Update",document.getElementById("itemId").value=s.id,document.getElementById("itemName").value=s.name,document.getElementById("itemType").value=s.type,document.getElementById("itemColour").value=s.colour,document.getElementById("itemQuantity").value=s.quantity,document.getElementById("itemPrice").value=0===s.price?"":parseFloat(s.price),document.getElementById("itemWeight").value=0===s.weight?"":parseFloat(s.weight),document.getElementById("itemWeightUnit").innerHTML=s.weightUnit??"kg",g=(c=new Date(s.date)).toLocaleString(),a.setDate(c),I(),d?(document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),m("warning")):(document.getElementById("deleteItemBtn").classList.remove("d-none"),document.getElementById("deleteItemBtn").setAttribute("onclick",`showDeleteModal(event, '${s.id}', '${s.name}', '${g}');`),m("primary")),r("itemFormMessageArea",""),e.show()):(console.error(n,api.fetchItems()),r("messageArea","Item not found.","danger",3))},window.addOrUpdateItem=t=>{t.preventDefault();let a=parseInt(t.target.itemId.value),l=t.target.itemName.value.trim(),i=t.target.itemType.value.trim(),s=t.target.itemColour.value,m=t.target.itemDate.value,g=document.getElementById("itemWeightUnit").innerHTML,u=t.target.itemQuantity.value,I=parseInt(u),p=t.target.itemPrice.value,b=parseFloat(p),B=t.target.itemWeight.value,v=parseFloat(B),E=new Date(m);if(l){if(i){if(s){if(isNaN(I)&&""!==u){r("itemFormMessageArea","Please enter a valid quantity.","danger",3);return}if(m&&!E){r("itemFormMessageArea","Please enter a valid date.","danger",3);return}else if(p&&(isNaN(b)||b<0)){r("itemFormMessageArea","Please enter a valid price.","danger",3);return}else if(B&&(isNaN(v)||v<0)){r("itemFormMessageArea","Please enter a valid weight.","danger",3);return}}else{r("itemFormMessageArea","Please select a colour.","danger",3);return}}else{r("itemFormMessageArea","Please enter item type.","danger",3);return}}else{r("itemFormMessageArea","Please enter item name.","danger",3);return}let f=api.searchItems(l);if(f&&f.id!==a){r("itemFormMessageArea",`Item already exists and was added on <em>${new Date(f.date).toLocaleString()}</em>`,"danger",4);return}m||(E=new Date).setSeconds(0);let h=E.toISOString().split(".")[0]+"Z";if(I=""===u?1:I,b=""===p?0:b,v=""===B?0:v,isNaN(a)){var L,A,M,T,w,k,H,S;let P;L=l,A=i,M=s,T=I,w=h,k=b,H=v,S=g,P=Date.now(),api.addItem(P,L,A,M,T,w,k,H,S)?(o(P,L,A,M,T,w,H?k*H:k),c(),n(),d("add",A),e.hide(),r("messageArea","Item successfully added!","success",3)):r("itemFormMessageArea","A problem occurred while adding item. Please try again later.","danger")}else!function t(a,l,i,s,o,m,c,g,u){let I=document.getElementById(`${a}-itemType`).innerHTML;api.updateItem(a,l,i,s,o,m,c,g,u)?(function e(t,a,l,n,i,r,s){let d=new Date(r),o=d.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),m=`<span class="currency-display" data-price="${s}">${y(s??0)}</span>`;document.getElementById(`${t}-itemName`).innerHTML=a,document.getElementById(`${t}-itemType`).innerHTML=l,document.getElementById(`${t}-quantity`).value=i,document.getElementById(`${t}-itemDate`).innerHTML=o;let c=document.getElementById(`${t}-itemPrice`);c.setAttribute("data-price",s),c.setAttribute("data-quantity",i),c.innerHTML=`<span class="currency-display" data-price="${s}">${m}</span>`,s?c.classList.remove("d-none"):c.classList.add("d-none"),document.getElementById(`${t}-header`).style.backgroundColor=n}(a,l,i,s,o,m,g?c*g:c),n(),I!==i&&d("update",i,I),e.hide(),r("messageArea","Item successfully updated!","success",3)):r("itemFormMessageArea","A problem occurred while updating item. Please try again later.","danger")}(a,l,i,s,I,h,b,v,g)},window.addUpdateSave=()=>{document.getElementById("addUpdateForm").requestSubmit()},window.showDeleteModal=(e,t,a,l)=>{e.preventDefault(),document.getElementById("deleteModal").setAttribute("data-id",t),document.getElementById("deleteItemName").innerHTML=a,document.getElementById("deleteDateTime").innerHTML=l;bootstrap.Modal.getOrCreateInstance(document.getElementById("deleteModal")).show()},window.deleteItem=()=>{!function t(a){let l=document.getElementById(`${a}-itemType`).innerHTML;if(api.deleteItem(a)){document.getElementById(`${a}`).remove(),n(),d("delete",l);bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),e.hide(),r("messageArea","Item successfully deleted!","success",3)}else r("deleteModalMessageArea","A problem occurred while deleting item. Please try again later.","danger")}(document.getElementById("deleteModal").getAttribute("data-id"))},window.toggleWeightUnit=e=>{let t=e.innerHTML,a=document.getElementById("itemWeight"),l=parseFloat(a.value);if(e.innerHTML="kg"===e.innerHTML?"lb":"kg",!isNaN(l)){var n,i;"kg"===t?a.value=(2.2046226218*(n=l)).toFixed(4):a.value=(.45359237*(i=l)).toFixed(4),I()}},window.formHelp=e=>{e.preventDefault();bootstrap.Modal.getOrCreateInstance(document.getElementById("formHelpModal")).show()}}();
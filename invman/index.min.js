!function(){let e=new bootstrap.Offcanvas("#itemForm"),t=4,a=flatpickr(".datepicker",{enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d, h:i K"});function n(e,t=!1){let a=0,n={};document.getElementById("item-list").innerHTML="",e.forEach(e=>{let l=e.weight?e.price*e.weight:e.price;t&&(n.hasOwnProperty(e.type)?n[e.type]++:n[e.type]=1),m(e.id,e.name,e.type,e.colour,e.quantity,e.date,l);let i=parseFloat(e.price),r=parseFloat(e.weight),s=parseInt(e.quantity);isNaN(i)||(a+=r?i*r*s:i*s)}),t&&d(n),c(),g(a)}function l(e){let t=0;document.querySelectorAll(".badge-price").forEach(e=>{let a=parseFloat(e.getAttribute("data-price")),n=parseInt(e.getAttribute("data-quantity"));isNaN(a)||(t+=a*n)}),e&&(t+=e),g(t)}function i(e=!1){!function e(t=!1){let a=api.fetchItems();if(!a&&t){s("messageArea","A problem occurred while loading file. Please make sure you are loading the correct inventory file.","danger",3);return}n(a,!0)}(e);let t;t=api.fetchTitle()??"Inventory",document.getElementById("inventoryTitle").value=t;let a;a=api.fetchCurrency()??"$",document.getElementById("currencySymbolSelect").value=a,u(a)}function r(){let e={};return document.querySelectorAll(".typeListBtn").forEach(t=>{e[t.innerHTML]=parseInt(t.getAttribute("data-count"))}),e}function s(e,t,a,n){if("string"!=typeof t||"string"!=typeof e||0==e.length)return;if(0===t.length){document.getElementById(e).innerHTML="<br>";return}let l=`<div class="alert alert-${a} alert-dismissible fade show d-flex shadow py-2" role="alert">
        <i class="${"success"===a?"bi bi-check-circle":"bi bi-exclamation-triangle"} me-2"></i><span class="fw-bold mx-auto text-center">${t}</span>
        <button type="button" class="btn-close pt-1" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;document.getElementById(e).innerHTML=l,n&&setTimeout(()=>{document.getElementById(e).innerHTML="<br>"},1e3*parseInt(n))}function d(e){let t='<button type="button" class="btn btn-sm btn-outline-primary active" id="typeListAllBtn" data-bs-toggle="button" onclick="typeFilter(this)">All</button>',a=Object.keys(e);a.sort(),a.forEach(a=>{t+=`<button type="button" class="btn btn-sm btn-outline-primary typeListBtn" data-count="${e[a]}" data-bs-toggle="button" onclick="typeFilter(this)">${a}</button>`}),document.getElementById("type-list").innerHTML=t}function m(e,t,a,n,l,i,r){let s=new Date(i),d=s.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),m=`<span class="currency-display" data-price="${r}">${y(r??0)}</span>`;document.getElementById("item-list").innerHTML+=`<div class="col" id="${e}">
        <div class="card shadow h-100">
          <div class="card-header d-flex fw-bold text-white justify-content-between" id="${e}-header" style="background-color: ${n}">
            <span class="d-flex align-items-center text-nowrap" id="${e}-itemName" title="Item Name">${t}</span>
            <div class="d-flex">
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}', true)" title="Duplicate"><i class="bi bi-copy"></i></button>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}')" title="Edit"><i class="bi bi-pencil-square"></i></button>
            </div>
          </div>
          <div class="card-body bg-secondary-subtle">
            <div class="d-flex justify-content-between mb-3">
              <span class="badge bg-primary" id="${e}-itemType" title="Item Type">${a}</span>
              <span class="badge bg-success badge-price${r?"":" d-none"}" id="${e}-itemPrice" data-price="${r??0}" data-quantity="${l}" title="Item Price">
                ${m}
              </span>
            </div>
            <div class="form-floating shadow">
              <input class="form-control" id="${e}-quantity" value="${l}" title="Quantity" disabled>
              <label for="floatingInput">Quantity</label>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-body-secondary" id="${e}-itemDate" title="Appointment Date">${d}</small>
          </div>
        </div>
      </div>`}function o(e){document.getElementById("itemFormHeader").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("itemFormHeader").classList.add(`bg-${e}-subtle`),document.getElementById("optionalHeaderBtn").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("optionalHeaderBtn").classList.add(`bg-${e}-subtle`)}function c(){let e=document.getElementById("addItemBtn");e&&e.remove(),document.getElementById("item-list").innerHTML+=`<div class="col" id="addItemBtn">
        <div class="card shadow h-100">
          <button class="btn btn-lg bg-body-tertiary text-primary h-100" title="Add Item" onclick="addItemMode();">
            <i class="bi bi-plus-square"></i>
          </button>
        </div>
      </div>`}function g(e){e?(document.getElementById("totalAmount").innerHTML=`<span class="currency-display" data-price="${e}">${y(e)}</span>`,document.getElementById("totalArea").classList.remove("d-none")):(document.getElementById("totalAmount").innerHTML="",document.getElementById("totalArea").classList.add("d-none"))}function y(e){let t=api.fetchCurrency()??"$",a="",n="";switch(t){case"$":a="en-US",n="USD";break;case"€":a="de-DE",n="EUR";break;case"\xa3":a="en-GB",n="GBP";break;case"\xa5":a="ja-JP",n="JPY";break;case"₩":a="ko-KR",n="KRW"}return e.toLocaleString(a,{style:"currency",currency:n})}function u(e){document.getElementById("currencySymbol").innerHTML=e,document.querySelectorAll(".currency-display").forEach(e=>{let t=parseFloat(e.getAttribute("data-price"));if(!isNaN(t)){let a=y(t);e.innerHTML=a}})}function I(){let e=parseFloat(document.getElementById("itemPrice").value),t=parseFloat(document.getElementById("itemWeight").value),a=parseInt(document.getElementById("itemQuantity").value),n=0;if(isNaN(e)||e<=0){document.getElementById("itemPriceTotal").innerHTML="";return}n=isNaN(t)||t<=0?e*(isNaN(a)||!a?1:a):e*t*(isNaN(a)||!a?1:a),document.getElementById("itemPriceTotal").innerHTML=`Total Price: ${y(n)}`}addEventListener("load",e=>{i(),window.matchMedia("(prefers-color-scheme: dark)").matches&&toggleTheme(),$("#item-list").sortable({items:".col:not('#addItemBtn')",opacity:.8,placeholder:"sortable-placeholder",tolerance:"pointer",stop:function(e,a){let n=a.item[0],l=api.fetchItems(),i=n.id,r=l.findIndex(e=>e.id.toString()===i);if(r>-1){let d=[...document.getElementById("item-list").querySelectorAll(".col")].indexOf(n);if(d===r)t?t--:(s("messageArea","If you are having issues scrolling on mobile, place your finger on an item's quantity box to scroll the page.","warning",8),t=4);else{let m=l.splice(r,1)[0];l.splice(d,0,m),api.updateItems(l),t=4}}else s("messageArea","Sorting error. Item not found.","danger",3)}})}),window.addEventListener("scroll",e=>{let t=document.getElementById("scrollToTop");t.style.display=window.scrollY>20?"block":"none"}),document.getElementById("itemForm").addEventListener("shown.bs.offcanvas",e=>{let t=document.getElementById("itemId").value;t||document.getElementById("itemName").focus();let a=bootstrap.Collapse.getInstance(document.getElementById("collapseOpt"));a&&a.show()}),document.getElementById("item-list").addEventListener("click",e=>{document.getElementById("navbarNav").classList.contains("show")&&document.getElementById("navbarNavHamburger").click()}),document.getElementById("formHelpModal").addEventListener("shown.bs.modal",e=>{document.getElementById("formHelpModal").focus()}),document.getElementById("formHelpModal").addEventListener("hidden.bs.modal",e=>{document.getElementById("itemForm").focus()}),document.getElementById("currencySymbolSelect").addEventListener("change",e=>{let t=e.target.value;api.editCurrency(t),u(t)}),document.getElementById("itemQuantity").addEventListener("change",e=>{I()}),document.getElementById("itemPrice").addEventListener("change",e=>{I()}),document.getElementById("itemWeight").addEventListener("change",e=>{I()}),window.clearData=()=>{document.getElementById("item-list").innerHTML="",localStorage.clear(),i();bootstrap.Modal.getInstance(document.getElementById("clearModal")).hide(),s("messageArea","Data cleared!","success",3)},window.loadFileListener=()=>{document.getElementById("fileInput").click()},window.loadFile=()=>{let t=document.getElementById("fileInput").files[0];if(t){let a=new FileReader;a.onload=t=>{let a=t.target.result;try{let n=JSON.parse(a);n.items?(s("messageArea",""),e.hide(),api.loadInventory(n),i(!0)):s("messageArea","Error loading file. Inventory data not found.","danger",3)}catch(l){console.error(l),s("messageArea","Error loading file. Could not read data.","danger",3)}},a.readAsText(t)}else s("messageArea","File not found.","danger",3)},window.saveFile=()=>{let e=api.fetchInventory();if(!e.items.length){s("messageArea","Save canceled. There are no items in the list.","danger",3);return}e.title||(e.title=document.getElementById("inventoryTitle").value),e.currency||(e.currency=document.getElementById("currencySymbolSelect").value);let t=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=document.getElementById("downloadLink");a.href=URL.createObjectURL(t),a.download="inventory.txt",a.click()},window.sortItems=e=>{if(!api.fetchItems().length){s("messageArea","There are no items to sort.","danger",3);return}document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")}),document.getElementById("typeListAllBtn").classList.add("active");let t;switch(e){case"1":t=api.sortItemsByName(!0);break;case"2":t=api.sortItemsByType();break;case"3":t=api.sortItemsByType(!0);break;case"4":t=api.sortItemsByDate();break;case"5":t=api.sortItemsByDate(!0);case"6":t=api.sortItemsByQuantity();break;case"7":t=api.sortItemsByQuantity(!0);break;case"8":t=api.sortItemsByPrice();break;case"9":t=api.sortItemsByPrice(!0);break;default:t=api.sortItemsByName()}n(t)},window.toggleTheme=()=>{let e=document.getElementById("themeBtn"),t=document.documentElement;t.hasAttribute("data-bs-theme")?(t.removeAttribute("data-bs-theme"),e.innerHTML='<i class="bi bi-moon-stars-fill mx-2"></i>Dark Mode'):(t.setAttribute("data-bs-theme","dark"),e.innerHTML='<i class="bi bi-brightness-high-fill mx-2"></i>Light Mode')},window.typeFilter=e=>{let t=document.getElementById("typeListAllBtn"),a=e.classList.contains("active");if("All"===e.innerHTML)a?(n(api.fetchItems()),document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")})):e.classList.add("active");else{let l=document.querySelectorAll(".typeListBtn.active");if(l.length){let i=[];document.querySelectorAll(".typeListBtn.active").forEach(e=>{i.push(e.innerHTML)});n(api.fetchItemsByType(i)),t.classList.remove("active")}else n(api.fetchItems()),t.classList.add("active")}},window.setTitle=e=>{e.value||(e.value="Inventory"),api.editTitle(e.value)},window.addItemMode=()=>{document.getElementById("itemOperation").innerHTML="Add",document.getElementById("itemId").value="",document.getElementById("itemName").value="",document.getElementById("itemType").value="",document.getElementById("itemColour").value="",document.getElementById("itemQuantity").value="",document.getElementById("itemPrice").value="",document.getElementById("itemWeight").value="",document.getElementById("itemWeightUnit").innerHTML="kg",document.getElementById("itemPriceTotal").innerHTML="",a.clear(),document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),o("success"),s("itemFormMessageArea",""),e.show()},window.updateItemMode=(t,n=!1)=>{var l,i,r,d;let m,c,g;l=t,i=n,(m=api.fetchItem(l)).id?(i&&(m.id=""),r=m,d=i,document.getElementById("itemOperation").innerHTML=d?"Duplicate":"Update",document.getElementById("itemId").value=r.id,document.getElementById("itemName").value=r.name,document.getElementById("itemType").value=r.type,document.getElementById("itemColour").value=r.colour,document.getElementById("itemQuantity").value=r.quantity,document.getElementById("itemPrice").value=0===r.price?"":parseFloat(r.price),document.getElementById("itemWeight").value=0===r.weight?"":parseFloat(r.weight),document.getElementById("itemWeightUnit").innerHTML=r.weightUnit??"kg",g=(c=new Date(r.date)).toLocaleString(),a.setDate(c),I(),d?(document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),o("warning")):(document.getElementById("deleteItemBtn").classList.remove("d-none"),document.getElementById("deleteItemBtn").setAttribute("onclick",`showDeleteModal(event, '${r.id}', '${r.name}', '${g}');`),o("primary")),s("itemFormMessageArea",""),e.show()):(console.error(l,api.fetchItems()),s("messageArea","Item not found.","danger",3))},window.addOrUpdateItem=t=>{t.preventDefault();let a=parseInt(t.target.itemId.value),n=t.target.itemName.value.trim(),i=t.target.itemType.value.trim(),o=t.target.itemColour.value,g=t.target.itemDate.value,u=document.getElementById("itemWeightUnit").innerHTML,I=t.target.itemQuantity.value,p=parseInt(I),b=t.target.itemPrice.value,B=parseFloat(b),v=t.target.itemWeight.value,f=parseFloat(v),E=new Date(g);if(n){if(i){if(o){if(isNaN(p)&&""!==I){s("itemFormMessageArea","Please enter a valid quantity.","danger",3);return}if(g&&!E){s("itemFormMessageArea","Please enter a valid date.","danger",3);return}else if(b&&(isNaN(B)||B<0)){s("itemFormMessageArea","Please enter a valid price.","danger",3);return}else if(v&&(isNaN(f)||f<0)){s("itemFormMessageArea","Please enter a valid weight.","danger",3);return}}else{s("itemFormMessageArea","Please select a colour.","danger",3);return}}else{s("itemFormMessageArea","Please enter item type.","danger",3);return}}else{s("itemFormMessageArea","Please enter item name.","danger",3);return}let h=api.searchItems(n);if(h&&h.id!==a){s("itemFormMessageArea",`Item already exists and was added on <em>${new Date(h.date).toLocaleString()}</em>`,"danger",4);return}g||(E=new Date).setSeconds(0);let L=E.toISOString().split(".")[0]+"Z";p=""===I?1:p,B=""===b?0:B,f=""===v?0:f,isNaN(a)?function t(a,n,i,o,g,y,u,I){let p=Date.now();if(api.addItem(p,a,n,i,o,g,y,u,I)){m(p,a,n,i,o,g,u?y*u:y),c(),l();let b=r();b.hasOwnProperty(n)?b[n]++:b[n]=1,d(b),e.hide(),s("messageArea","Item successfully added!","success",3)}else s("itemFormMessageArea","A problem occurred while adding item. Please try again later.","danger")}(n,i,o,p,L,B,f,u):function t(a,n,i,m,o,c,g,u,I){let p=document.getElementById(`${a}-itemType`).innerHTML;if(api.updateItem(a,n,i,m,o,c,g,u,I)){if(function e(t,a,n,l,i,r,s){let d=new Date(r),m=d.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),o=`<span class="currency-display" data-price="${s}">${y(s??0)}</span>`;document.getElementById(`${t}-itemName`).innerHTML=a,document.getElementById(`${t}-itemType`).innerHTML=n,document.getElementById(`${t}-quantity`).value=i,document.getElementById(`${t}-itemDate`).innerHTML=m;let c=document.getElementById(`${t}-itemPrice`);c.setAttribute("data-price",s),c.setAttribute("data-quantity",i),c.innerHTML=`<span class="currency-display" data-price="${s}">${o}</span>`,s?c.classList.remove("d-none"):c.classList.add("d-none"),document.getElementById(`${t}-header`).style.backgroundColor=l}(a,n,i,m,o,c,u?g*u:g),l(),p!==i){let b=r();b.hasOwnProperty(i)?b[i]++:b[i]=1,b.hasOwnProperty(p)&&(b[p]--,0===b[p]&&delete b[p]),d(b)}e.hide(),s("messageArea","Item successfully updated!","success",3)}else s("itemFormMessageArea","A problem occurred while updating item. Please try again later.","danger")}(a,n,i,o,p,L,B,f,u)},window.addUpdateSave=()=>{document.getElementById("addUpdateForm").requestSubmit()},window.showDeleteModal=(e,t,a,n)=>{e.preventDefault(),document.getElementById("deleteModal").setAttribute("data-id",t),document.getElementById("deleteItemName").innerHTML=a,document.getElementById("deleteDateTime").innerHTML=n;bootstrap.Modal.getOrCreateInstance(document.getElementById("deleteModal")).show()},window.deleteItem=()=>{!function t(a){let n=document.getElementById(`${a}-itemType`).innerHTML;if(api.deleteItem(a)){document.getElementById(`${a}`).remove(),l();let i=r();i.hasOwnProperty(n)&&(i[n]--,0===i[n]&&delete i[n]),d(i);bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),e.hide(),s("messageArea","Item successfully deleted!","success",3)}else s("deleteModalMessageArea","A problem occurred while deleting item. Please try again later.","danger")}(document.getElementById("deleteModal").getAttribute("data-id"))},window.toggleWeightUnit=(e,t)=>{t.preventDefault();let a=e.innerHTML,n=document.getElementById("itemWeight"),l=parseFloat(n.value);if(e.innerHTML="kg"===e.innerHTML?"lb":"kg",!isNaN(l)){var i,r;"kg"===a?n.value=(2.2046226218*(i=l)).toFixed(4):n.value=(.45359237*(r=l)).toFixed(4),I()}},window.formHelp=e=>{e.preventDefault();bootstrap.Modal.getOrCreateInstance(document.getElementById("formHelpModal")).show()}}();
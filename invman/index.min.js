!function(){let e=new bootstrap.Offcanvas("#itemForm"),t=4,a=flatpickr(".datepicker",{enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d, h:i K"});function n(e){let t=0;e.forEach(e=>{let a=e.weight?s(e.price,e.weight):e.price;l(e.id,e.name,e.type,e.colour,e.quantity,e.date,a);let n=parseFloat(e.price),i=parseInt(e.quantity);isNaN(n)||(t+=n*i)}),o(),c(t)}function l(e,t,a,n,l,i,r){let s=new Date(i),d=s.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),m=g(r??0);document.getElementById("item-list").innerHTML+=`<div class="col" id="${e}">
        <div class="card shadow h-100">
          <div class="card-header d-flex fw-bold text-white justify-content-between" id="${e}-header" style="background-color: ${n}">
            <span class="d-flex align-items-center text-nowrap" id="${e}-itemName" title="Item Name">${t}</span>
            <div>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}', true)" title="Duplicate"><i class="bi bi-copy"></i></button>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}')" title="Edit"><i class="bi bi-pencil-square"></i></button>
            </div>
          </div>
          <div class="card-body bg-secondary-subtle">
            <div class="d-flex justify-content-between mb-3">
              <span class="badge bg-primary" id="${e}-itemType" title="Item Type">${a}</span>
              <span class="badge bg-success badge-price${r?"":" d-none"}" id="${e}-itemPrice" data-price="${r??0}" data-quantity="${l}" title="Item Price">
                <span class="currency-symbol">$</span>${m}
              </span>
            </div>
            <div class="form-floating shadow">
              <input class="form-control" id="${e}-quantity" value="${l}" title="Quantity" disabled>
              <label for="floatingInput">Quantity</label>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-body-secondary" id="${e}-itemDate" title="Appointment Date">${d}</small>
          </div>
        </div>
      </div>`}function i(e){let t=0;document.querySelectorAll(".badge-price").forEach(e=>{let a=parseFloat(e.getAttribute("data-price")),n=parseInt(e.getAttribute("data-quantity"));isNaN(a)||(t+=a*n)}),e&&(t+=e),c(t)}function r(e=!1){!function e(t=!1){let a=api.fetchItems();if(!a&&t){d("messageArea","A problem occurred while loading file. Please make sure you are loading the correct inventory file.","danger",3);return}n(a)}(e);let t;t=api.fetchTitle()??"Inventory",document.getElementById("inventoryTitle").value=t;let a;a=api.fetchCurrency()??"$",document.getElementById("currencySymbolSelect").value=a,u(a)}function s(e,t){return(e*t).toFixed(2)}function d(e,t,a,n){if("string"!=typeof t||"string"!=typeof e||0==e.length)return;if(0===t.length){document.getElementById(e).innerHTML="<br>";return}let l=`<div class="alert alert-${a} alert-dismissible fade show d-flex shadow py-2" role="alert">
        <i class="${"success"===a?"bi bi-check-circle":"bi bi-exclamation-triangle"} me-2"></i><span class="fw-bold mx-auto text-center">${t}</span>
        <button type="button" class="btn-close pt-1" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;document.getElementById(e).innerHTML=l,n&&setTimeout(()=>{document.getElementById(e).innerHTML="<br>"},1e3*parseInt(n))}function m(e){document.getElementById("itemFormHeader").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("itemFormHeader").classList.add(`bg-${e}-subtle`)}function o(){let e=document.getElementById("addItemBtn");e&&e.remove(),document.getElementById("item-list").innerHTML+=`<div class="col" id="addItemBtn">
        <div class="card shadow h-100">
          <button class="btn btn-lg bg-body-tertiary text-primary h-100" title="Add Item" onclick="addItemMode();">
            <i class="bi bi-plus-square"></i>
          </button>
        </div>
      </div>`}function c(e){e?(document.getElementById("totalAmount").innerHTML=`<span class="currency-symbol">$</span>${g(e)}`,document.getElementById("totalArea").classList.remove("d-none")):(document.getElementById("totalAmount").innerHTML="",document.getElementById("totalArea").classList.add("d-none"))}function g(e){return e.toLocaleString("en-US",{minimumFractionDigits:2})}function u(e){document.querySelectorAll(".currency-symbol").forEach(t=>{t.innerHTML=e})}addEventListener("load",e=>{r(),window.matchMedia("(prefers-color-scheme: dark)").matches&&toggleTheme(),$("#item-list").sortable({items:".col:not('#addItemBtn')",opacity:.8,placeholder:"sortable-placeholder",tolerance:"pointer",stop:function(e,a){let n=a.item[0],l=api.fetchItems(),i=n.id,r=l.findIndex(e=>e.id.toString()===i);if(r>-1){let s=[...document.getElementById("item-list").querySelectorAll(".col")].indexOf(n);if(s===r)t?t--:(d("messageArea","If you are having issues scrolling on mobile, place your finger on an item's quantity box to scroll the page.","warning",8),t=4);else{let m=l.splice(r,1)[0];l.splice(s,0,m),api.updateItems(l),t=4}}else d("messageArea","Sorting error. Item not found.","danger",3)}})}),document.getElementById("itemForm").addEventListener("shown.bs.offcanvas",e=>{let t=document.getElementById("itemId").value;t||document.getElementById("itemName").focus();let a=bootstrap.Collapse.getInstance(document.getElementById("collapseOpt"));a&&a.show()}),document.getElementById("currencySymbolSelect").addEventListener("change",e=>{let t=e.target.value;u(t),api.editCurrency(t)}),document.getElementById("itemPrice").addEventListener("change",e=>{e.currentTarget.value=parseFloat(e.currentTarget.value).toFixed(2)}),window.clearData=()=>{document.getElementById("item-list").innerHTML="",localStorage.clear(),r();bootstrap.Modal.getInstance(document.getElementById("clearModal")).hide(),d("messageArea","Data cleared!","success",3)},window.loadFileListener=()=>{document.getElementById("fileInput").click()},window.loadFile=()=>{let t=document.getElementById("fileInput").files[0];if(t){let a=new FileReader;a.onload=t=>{let a=t.target.result;try{let n=JSON.parse(a);n.items?(d("messageArea",""),e.hide(),document.getElementById("item-list").innerHTML="",api.loadInventory(n),r(!0)):d("messageArea","Error loading file. Inventory data not found.","danger",3)}catch(l){console.error(l),d("messageArea","Error loading file. Could not read data.","danger",3)}},a.readAsText(t)}else d("messageArea","File not found.","danger",3)},window.saveFile=()=>{let e=api.fetchInventory();if(!e.items.length){d("messageArea","Save canceled. There are no items in the list.","danger",3);return}e.title||(e.title=document.getElementById("inventoryTitle").value),e.currency||(e.currency=document.getElementById("currencySymbolSelect").value);let t=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=document.getElementById("downloadLink");a.href=URL.createObjectURL(t),a.download="inventory.txt",a.click()},window.sortItems=e=>{if(!api.fetchItems().length){d("messageArea","There are no items to sort.","danger",3);return}let t;switch(e){case"1":t=api.sortItemsByName(!0);break;case"2":t=api.sortItemsByType();break;case"3":t=api.sortItemsByType(!0);break;case"4":t=api.sortItemsByDate();break;case"5":t=api.sortItemsByDate(!0);case"6":t=api.sortItemsByQuantity();break;case"7":t=api.sortItemsByQuantity(!0);break;default:t=api.sortItemsByName()}document.getElementById("item-list").innerHTML="",n(t)},window.toggleTheme=()=>{let e=document.getElementById("themeBtn"),t=document.documentElement;t.hasAttribute("data-bs-theme")?(t.removeAttribute("data-bs-theme"),e.innerHTML='<i class="bi bi-moon-stars-fill mx-2"></i>Dark Mode'):(t.setAttribute("data-bs-theme","dark"),e.innerHTML='<i class="bi bi-brightness-high-fill mx-2"></i>Light Mode')},window.setTitle=e=>{e.value||(e.value="Inventory"),api.editTitle(e.value)},window.addItemMode=()=>{document.getElementById("itemOperation").innerHTML="Add",document.getElementById("itemId").value="",document.getElementById("itemName").value="",document.getElementById("itemType").value="",document.getElementById("itemColour").value="",document.getElementById("itemQuantity").value="",document.getElementById("itemPrice").value="",document.getElementById("itemWeight").value="",document.getElementById("itemWeightUnit").innerHTML="kg",a.clear(),document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),m("success"),d("itemFormMessageArea",""),e.show()},window.updateItemMode=(t,n=!1)=>{var l,i,r,s;let o,c,g;l=t,i=n,(o=api.fetchItem(l)).id?(i&&(o.id=""),r=o,s=i,document.getElementById("itemOperation").innerHTML=s?"Duplicate":"Update",document.getElementById("itemId").value=r.id,document.getElementById("itemName").value=r.name,document.getElementById("itemType").value=r.type,document.getElementById("itemColour").value=r.colour,document.getElementById("itemQuantity").value=r.quantity,document.getElementById("itemPrice").value=0===r.price?"":parseFloat(r.price).toFixed(2),document.getElementById("itemWeight").value=0===r.weight?"":parseFloat(r.weight).toFixed(2),document.getElementById("itemWeightUnit").innerHTML=r.weightUnit??"kg",g=(c=new Date(r.date)).toLocaleString(),a.setDate(c),s?(document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),m("warning")):(document.getElementById("deleteItemBtn").classList.remove("d-none"),document.getElementById("deleteItemBtn").setAttribute("onclick",`showDeleteModal(event, '${r.id}', '${r.name}', '${g}');`),m("primary")),d("itemFormMessageArea",""),e.show()):(console.error(l,api.fetchItems()),d("messageArea","Item not found.","danger",3))},window.addOrUpdateItem=t=>{var a,n,r,m,c,u,y,I,b,v,p,f,B,h,E,M,A;t.preventDefault();let L=parseInt(t.target.itemId.value),T=t.target.itemName.value.trim(),w=t.target.itemType.value.trim(),k=t.target.itemColour.value,F=t.target.itemDate.value,H=document.getElementById("itemWeightUnit").innerHTML,x=t.target.itemQuantity.value,S=parseInt(x),D=t.target.itemPrice.value,P=parseFloat(D),q=t.target.itemWeight.value,_=parseFloat(q),U=new Date(F);if(T){if(w){if(k){if(isNaN(S)&&""!==x){d("itemFormMessageArea","Please enter a valid quantity.","danger",3);return}if(F&&!U){d("itemFormMessageArea","Please enter a valid date.","danger",3);return}else if(D&&(isNaN(P)||P<0)){d("itemFormMessageArea","Please enter a valid price.","danger",3);return}else if(q&&(isNaN(_)||_<0)){d("itemFormMessageArea","Please enter a valid weight.","danger",3);return}}else{d("itemFormMessageArea","Please select a colour.","danger",3);return}}else{d("itemFormMessageArea","Please enter item type.","danger",3);return}}else{d("itemFormMessageArea","Please enter item name.","danger",3);return}let C=api.searchItems(T);if(C&&C.id!==L){d("itemFormMessageArea",`Item already exists and was added on <em>${new Date(C.date).toLocaleString()}</em>`,"danger",4);return}F||(U=new Date).setSeconds(0);let N=U.toISOString().split(".")[0]+"Z",O;S=""===x?1:S,P=""===D?0:P,_=""===q?0:_,isNaN(L)?(a=T,n=w,r=k,m=S,c=N,u=P,y=_,I=H,O=Date.now(),api.addItem(O,a,n,r,m,c,u,y,I)?(l(O,a,n,r,m,c,y?s(u,y):u),o(),i(),e.hide(),d("messageArea","Item successfully added!","success",3)):d("itemFormMessageArea","A problem occurred while adding item. Please try again later.","danger")):(b=L,v=T,p=w,f=k,B=S,h=N,E=P,M=_,A=H,api.updateItem(b,v,p,f,B,h,E,M,A)?(function e(t,a,n,l,i,r,s){let d=new Date(r),m=d.toLocaleString(),o=g(s??0);document.getElementById(`${t}-itemName`).innerHTML=a,document.getElementById(`${t}-itemType`).innerHTML=n,document.getElementById(`${t}-quantity`).value=i,document.getElementById(`${t}-itemDate`).innerHTML=m;let c=document.getElementById(`${t}-itemPrice`);c.setAttribute("data-price",s),c.setAttribute("data-quantity",i),c.innerHTML=`<span class="currency-symbol">$</span>${o}`,s?c.classList.remove("d-none"):c.classList.add("d-none"),document.getElementById(`${t}-header`).style.backgroundColor=l}(b,v,p,f,B,h,M?s(E,M):E),i(),e.hide(),d("messageArea","Item successfully updated!","success",3)):d("itemFormMessageArea","A problem occurred while updating item. Please try again later.","danger"))},window.addUpdateSave=()=>{document.getElementById("addUpdateForm").requestSubmit()},window.showDeleteModal=(e,t,a,n)=>{e.preventDefault(),document.getElementById("deleteModal").setAttribute("data-id",t),document.getElementById("deleteItemName").innerHTML=a,document.getElementById("deleteDateTime").innerHTML=n;bootstrap.Modal.getOrCreateInstance(document.getElementById("deleteModal")).show()},window.deleteItem=()=>{!function t(a){if(api.deleteItem(a)){document.getElementById(`${a}`).remove(),i();bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),e.hide(),d("messageArea","Item successfully deleted!","success",3)}else d("deleteModalMessageArea","A problem occurred while deleting item. Please try again later.","danger")}(document.getElementById("deleteModal").getAttribute("data-id"))},window.toggleWeightUnit=(e,t)=>{t.preventDefault();let a=e.innerHTML,n=document.getElementById("itemWeight"),l=parseFloat(n.value);if(e.innerHTML="kg"===e.innerHTML?"lb":"kg",!isNaN(l)){var i,r;"kg"===a?n.value=(2.2046226218*(i=l)).toFixed(4):n.value=(.45359237*(r=l)).toFixed(4)}}}();
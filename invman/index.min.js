!function(){let e=new bootstrap.Offcanvas("#itemForm"),t=4,a=flatpickr(".datepicker",{enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d, h:i K"});function l(e,t=!1){let a=0,l=[];document.getElementById("item-list").innerHTML="",e.forEach(e=>{let n=e.weight?s(e.price,e.weight):e.price;t&&!l.includes(e.type)&&l.push(e.type),m(e.id,e.name,e.type,e.colour,e.quantity,e.date,n);let i=parseFloat(e.price),r=parseFloat(e.weight),d=parseInt(e.quantity);isNaN(i)||(a+=r?i*r*d:i*d)}),t&&o(l),g(),u(a)}function n(e){let t=0;document.querySelectorAll(".badge-price").forEach(e=>{let a=parseFloat(e.getAttribute("data-price")),l=parseInt(e.getAttribute("data-quantity"));isNaN(a)||(t+=a*l)}),e&&(t+=e),u(t)}function i(e=!1){!function e(t=!1){let a=api.fetchItems();if(!a&&t){d("messageArea","A problem occurred while loading file. Please make sure you are loading the correct inventory file.","danger",3);return}l(a,!0)}(e);let t;t=api.fetchTitle()??"Inventory",document.getElementById("inventoryTitle").value=t;let a;a=api.fetchCurrency()??"$",document.getElementById("currencySymbolSelect").value=a,I(a)}function r(){let e=[];return document.querySelectorAll(".typeListBtn").forEach(t=>{e.push(t.innerHTML)}),e}function s(e,t){return(e*t).toFixed(2)}function d(e,t,a,l){if("string"!=typeof t||"string"!=typeof e||0==e.length)return;if(0===t.length){document.getElementById(e).innerHTML="<br>";return}let n=`<div class="alert alert-${a} alert-dismissible fade show d-flex shadow py-2" role="alert">
        <i class="${"success"===a?"bi bi-check-circle":"bi bi-exclamation-triangle"} me-2"></i><span class="fw-bold mx-auto text-center">${t}</span>
        <button type="button" class="btn-close pt-1" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;document.getElementById(e).innerHTML=n,l&&setTimeout(()=>{document.getElementById(e).innerHTML="<br>"},1e3*parseInt(l))}function o(e){let t='<button type="button" class="btn btn-sm btn-outline-primary active" id="typeListAllBtn" data-bs-toggle="button" onclick="typeFilter(this)">All</button>';e.sort(),e.forEach(e=>{t+=`<button type="button" class="btn btn-sm btn-outline-primary typeListBtn" data-bs-toggle="button" onclick="typeFilter(this)">${e}</button>`}),document.getElementById("type-list").innerHTML=t}function m(e,t,a,l,n,i,r){let s=new Date(i),d=s.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"}),o=y(r??0);document.getElementById("item-list").innerHTML+=`<div class="col" id="${e}">
        <div class="card shadow h-100">
          <div class="card-header d-flex fw-bold text-white justify-content-between" id="${e}-header" style="background-color: ${l}">
            <span class="d-flex align-items-center text-nowrap" id="${e}-itemName" title="Item Name">${t}</span>
            <div>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}', true)" title="Duplicate"><i class="bi bi-copy"></i></button>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}')" title="Edit"><i class="bi bi-pencil-square"></i></button>
            </div>
          </div>
          <div class="card-body bg-secondary-subtle">
            <div class="d-flex justify-content-between mb-3">
              <span class="badge bg-primary" id="${e}-itemType" title="Item Type">${a}</span>
              <span class="badge bg-success badge-price${r?"":" d-none"}" id="${e}-itemPrice" data-price="${r??0}" data-quantity="${n}" title="Item Price">
                <span class="currency-symbol">$</span>${o}
              </span>
            </div>
            <div class="form-floating shadow">
              <input class="form-control" id="${e}-quantity" value="${n}" title="Quantity" disabled>
              <label for="floatingInput">Quantity</label>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-body-secondary" id="${e}-itemDate" title="Appointment Date">${d}</small>
          </div>
        </div>
      </div>`}function c(e){document.getElementById("itemFormHeader").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("itemFormHeader").classList.add(`bg-${e}-subtle`),document.getElementById("optionalHeaderBtn").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("optionalHeaderBtn").classList.add(`bg-${e}-subtle`)}function g(){let e=document.getElementById("addItemBtn");e&&e.remove(),document.getElementById("item-list").innerHTML+=`<div class="col" id="addItemBtn">
        <div class="card shadow h-100">
          <button class="btn btn-lg bg-body-tertiary text-primary h-100" title="Add Item" onclick="addItemMode();">
            <i class="bi bi-plus-square"></i>
          </button>
        </div>
      </div>`}function u(e){e?(document.getElementById("totalAmount").innerHTML=`<span class="currency-symbol">$</span>${y(e)}`,document.getElementById("totalArea").classList.remove("d-none")):(document.getElementById("totalAmount").innerHTML="",document.getElementById("totalArea").classList.add("d-none"))}function y(e){return e.toLocaleString("en-US",{minimumFractionDigits:2})}function I(e){document.querySelectorAll(".currency-symbol").forEach(t=>{t.innerHTML=e})}addEventListener("load",e=>{i(),window.matchMedia("(prefers-color-scheme: dark)").matches&&toggleTheme(),$("#item-list").sortable({items:".col:not('#addItemBtn')",opacity:.8,placeholder:"sortable-placeholder",tolerance:"pointer",stop:function(e,a){let l=a.item[0],n=api.fetchItems(),i=l.id,r=n.findIndex(e=>e.id.toString()===i);if(r>-1){let s=[...document.getElementById("item-list").querySelectorAll(".col")].indexOf(l);if(s===r)t?t--:(d("messageArea","If you are having issues scrolling on mobile, place your finger on an item's quantity box to scroll the page.","warning",8),t=4);else{let o=n.splice(r,1)[0];n.splice(s,0,o),api.updateItems(n),t=4}}else d("messageArea","Sorting error. Item not found.","danger",3)}})}),document.getElementById("itemForm").addEventListener("shown.bs.offcanvas",e=>{let t=document.getElementById("itemId").value;t||document.getElementById("itemName").focus();let a=bootstrap.Collapse.getInstance(document.getElementById("collapseOpt"));a&&a.show()}),document.getElementById("item-list").addEventListener("click",e=>{document.getElementById("navbarNav").classList.contains("show")&&document.getElementById("navbarNavHamburger").click()}),document.getElementById("formHelpModal").addEventListener("shown.bs.modal",e=>{document.getElementById("formHelpModal").focus()}),document.getElementById("formHelpModal").addEventListener("hidden.bs.modal",e=>{document.getElementById("itemForm").focus()}),document.getElementById("currencySymbolSelect").addEventListener("change",e=>{let t=e.target.value;I(t),api.editCurrency(t)}),window.clearData=()=>{document.getElementById("item-list").innerHTML="",localStorage.clear(),i();bootstrap.Modal.getInstance(document.getElementById("clearModal")).hide(),d("messageArea","Data cleared!","success",3)},window.loadFileListener=()=>{document.getElementById("fileInput").click()},window.loadFile=()=>{let t=document.getElementById("fileInput").files[0];if(t){let a=new FileReader;a.onload=t=>{let a=t.target.result;try{let l=JSON.parse(a);l.items?(d("messageArea",""),e.hide(),api.loadInventory(l),i(!0)):d("messageArea","Error loading file. Inventory data not found.","danger",3)}catch(n){console.error(n),d("messageArea","Error loading file. Could not read data.","danger",3)}},a.readAsText(t)}else d("messageArea","File not found.","danger",3)},window.saveFile=()=>{let e=api.fetchInventory();if(!e.items.length){d("messageArea","Save canceled. There are no items in the list.","danger",3);return}e.title||(e.title=document.getElementById("inventoryTitle").value),e.currency||(e.currency=document.getElementById("currencySymbolSelect").value);let t=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=document.getElementById("downloadLink");a.href=URL.createObjectURL(t),a.download="inventory.txt",a.click()},window.sortItems=e=>{if(!api.fetchItems().length){d("messageArea","There are no items to sort.","danger",3);return}document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")}),document.getElementById("typeListAllBtn").classList.add("active");let t;switch(e){case"1":t=api.sortItemsByName(!0);break;case"2":t=api.sortItemsByType();break;case"3":t=api.sortItemsByType(!0);break;case"4":t=api.sortItemsByDate();break;case"5":t=api.sortItemsByDate(!0);case"6":t=api.sortItemsByQuantity();break;case"7":t=api.sortItemsByQuantity(!0);break;default:t=api.sortItemsByName()}l(t)},window.toggleTheme=()=>{let e=document.getElementById("themeBtn"),t=document.documentElement;t.hasAttribute("data-bs-theme")?(t.removeAttribute("data-bs-theme"),e.innerHTML='<i class="bi bi-moon-stars-fill mx-2"></i>Dark Mode'):(t.setAttribute("data-bs-theme","dark"),e.innerHTML='<i class="bi bi-brightness-high-fill mx-2"></i>Light Mode')},window.typeFilter=e=>{let t=document.getElementById("typeListAllBtn"),a=e.classList.contains("active");if("All"===e.innerHTML)a?(l(api.fetchItems()),document.querySelectorAll(".typeListBtn.active").forEach(e=>{e.classList.remove("active")})):e.classList.add("active");else{let n=document.querySelectorAll(".typeListBtn.active");if(n.length){let i=[];document.querySelectorAll(".typeListBtn.active").forEach(e=>{i.push(e.innerHTML)});l(api.fetchItemsByType(i)),t.classList.remove("active")}else l(api.fetchItems()),t.classList.add("active")}},window.setTitle=e=>{e.value||(e.value="Inventory"),api.editTitle(e.value)},window.addItemMode=()=>{document.getElementById("itemOperation").innerHTML="Add",document.getElementById("itemId").value="",document.getElementById("itemName").value="",document.getElementById("itemType").value="",document.getElementById("itemColour").value="",document.getElementById("itemQuantity").value="",document.getElementById("itemPrice").value="",document.getElementById("itemWeight").value="",document.getElementById("itemWeightUnit").innerHTML="kg",a.clear(),document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),c("success"),d("itemFormMessageArea",""),e.show()},window.updateItemMode=(t,l=!1)=>{var n,i,r,s;let o,m,g;n=t,i=l,(o=api.fetchItem(n)).id?(i&&(o.id=""),r=o,s=i,document.getElementById("itemOperation").innerHTML=s?"Duplicate":"Update",document.getElementById("itemId").value=r.id,document.getElementById("itemName").value=r.name,document.getElementById("itemType").value=r.type,document.getElementById("itemColour").value=r.colour,document.getElementById("itemQuantity").value=r.quantity,document.getElementById("itemPrice").value=0===r.price?"":parseFloat(r.price).toFixed(2),document.getElementById("itemWeight").value=0===r.weight?"":parseFloat(r.weight).toFixed(4),document.getElementById("itemWeightUnit").innerHTML=r.weightUnit??"kg",g=(m=new Date(r.date)).toLocaleString(),a.setDate(m),s?(document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),c("warning")):(document.getElementById("deleteItemBtn").classList.remove("d-none"),document.getElementById("deleteItemBtn").setAttribute("onclick",`showDeleteModal(event, '${r.id}', '${r.name}', '${g}');`),c("primary")),d("itemFormMessageArea",""),e.show()):(console.error(n,api.fetchItems()),d("messageArea","Item not found.","danger",3))},window.addOrUpdateItem=t=>{t.preventDefault();let a=parseInt(t.target.itemId.value),l=t.target.itemName.value.trim(),i=t.target.itemType.value.trim(),c=t.target.itemColour.value,u=t.target.itemDate.value,I=document.getElementById("itemWeightUnit").innerHTML,b=t.target.itemQuantity.value,p=parseInt(b),f=t.target.itemPrice.value,v=parseFloat(f),B=t.target.itemWeight.value,h=parseFloat(B),E=new Date(u);if(l){if(i){if(c){if(isNaN(p)&&""!==b){d("itemFormMessageArea","Please enter a valid quantity.","danger",3);return}if(u&&!E){d("itemFormMessageArea","Please enter a valid date.","danger",3);return}else if(f&&(isNaN(v)||v<0)){d("itemFormMessageArea","Please enter a valid price.","danger",3);return}else if(B&&(isNaN(h)||h<0)){d("itemFormMessageArea","Please enter a valid weight.","danger",3);return}}else{d("itemFormMessageArea","Please select a colour.","danger",3);return}}else{d("itemFormMessageArea","Please enter item type.","danger",3);return}}else{d("itemFormMessageArea","Please enter item name.","danger",3);return}let L=api.searchItems(l);if(L&&L.id!==a){d("itemFormMessageArea",`Item already exists and was added on <em>${new Date(L.date).toLocaleString()}</em>`,"danger",4);return}u||(E=new Date).setSeconds(0);let M=E.toISOString().split(".")[0]+"Z";p=""===b?1:p,v=""===f?0:v,h=""===B?0:h,isNaN(a)?function t(a,l,i,c,u,y,I,b){let p=Date.now();if(api.addItem(p,a,l,i,c,u,y,I,b)){m(p,a,l,i,c,u,I?s(y,I):y),g(),n();let f=r();f.includes(l)||(f.push(l),o(f)),e.hide(),d("messageArea","Item successfully added!","success",3)}else d("itemFormMessageArea","A problem occurred while adding item. Please try again later.","danger")}(l,i,c,p,M,v,h,I):function t(a,l,i,m,c,g,u,I,b){if(api.updateItem(a,l,i,m,c,g,u,I,b)){(function e(t,a,l,n,i,r,s){let d=new Date(r),o=d.toLocaleString(),m=y(s??0);document.getElementById(`${t}-itemName`).innerHTML=a,document.getElementById(`${t}-itemType`).innerHTML=l,document.getElementById(`${t}-quantity`).value=i,document.getElementById(`${t}-itemDate`).innerHTML=o;let c=document.getElementById(`${t}-itemPrice`);c.setAttribute("data-price",s),c.setAttribute("data-quantity",i),c.innerHTML=`<span class="currency-symbol">$</span>${m}`,s?c.classList.remove("d-none"):c.classList.add("d-none"),document.getElementById(`${t}-header`).style.backgroundColor=n})(a,l,i,m,c,g,I?s(u,I):u),n();let p=r();p.includes(i)||(p.push(i),o(p)),e.hide(),d("messageArea","Item successfully updated!","success",3)}else d("itemFormMessageArea","A problem occurred while updating item. Please try again later.","danger")}(a,l,i,c,p,M,v,h,I)},window.addUpdateSave=()=>{document.getElementById("addUpdateForm").requestSubmit()},window.showDeleteModal=(e,t,a,l)=>{e.preventDefault(),document.getElementById("deleteModal").setAttribute("data-id",t),document.getElementById("deleteItemName").innerHTML=a,document.getElementById("deleteDateTime").innerHTML=l;bootstrap.Modal.getOrCreateInstance(document.getElementById("deleteModal")).show()},window.deleteItem=()=>{!function t(a){if(api.deleteItem(a)){document.getElementById(`${a}`).remove(),n();bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),e.hide(),d("messageArea","Item successfully deleted!","success",3)}else d("deleteModalMessageArea","A problem occurred while deleting item. Please try again later.","danger")}(document.getElementById("deleteModal").getAttribute("data-id"))},window.toggleWeightUnit=(e,t)=>{t.preventDefault();let a=e.innerHTML,l=document.getElementById("itemWeight"),n=parseFloat(l.value);if(e.innerHTML="kg"===e.innerHTML?"lb":"kg",!isNaN(n)){var i,r;"kg"===a?l.value=(2.2046226218*(i=n)).toFixed(4):l.value=(.45359237*(r=n)).toFixed(4)}},window.formHelp=e=>{e.preventDefault();bootstrap.Modal.getOrCreateInstance(document.getElementById("formHelpModal")).show()}}();
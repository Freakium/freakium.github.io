!function(){let e=new bootstrap.Offcanvas("#itemForm"),t=4,a=flatpickr(".datepicker",{enableTime:!0,dateFormat:"Y-m-d H:i",altInput:!0,altFormat:"Y-m-d, h:i K"});function n(e){let t=0;e.forEach(e=>{l(e.id,e.name,e.type,e.colour,e.quantity,e.date,e.price);let a=parseFloat(e.price),n=parseInt(e.quantity);isNaN(a)||(t+=a*n)}),m(),o(t)}function l(e,t,a,n,l,i,r){let s=new Date(i),d=s.toLocaleString("en-US",{dateStyle:"long",timeStyle:"short"});document.getElementById("item-list").innerHTML+=`<div class="col" id="${e}">
        <div class="card shadow h-100">
          <div class="card-header d-flex fw-bold text-white justify-content-between" id="${e}-header" style="background-color: ${n}">
            <span class="d-flex align-items-center text-nowrap" id="${e}-itemName" title="Item Name">${t}</span>
            <div>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}', true)" title="Duplicate"><i class="bi bi-copy"></i></button>
              <button class="btn btn-sm btn-link" onclick="updateItemMode('${e}')" title="Edit"><i class="bi bi-pencil-square"></i></button>
            </div>
          </div>
          <div class="card-body bg-secondary-subtle">
            <div class="d-flex justify-content-between mb-3">
              <span class="badge bg-primary" id="${e}-itemType" title="Item Type">${a}</span>
              <span class="badge bg-success badge-price${r?"":" d-none"}" id="${e}-itemPrice" data-price="${r??0}" data-quantity="${l}" title="Item Price">
                <span class="currency-symbol">$</span>${c(r??0)}
              </span>
            </div>
            <div class="form-floating shadow">
              <input class="form-control" id="${e}-quantity" value="${l}" title="Quantity" disabled>
              <label for="floatingInput">Quantity</label>
            </div>
          </div>
          <div class="card-footer">
            <small class="text-body-secondary" id="${e}-itemDate" title="Appointment Date">${d}</small>
          </div>
        </div>
      </div>`}function i(e){let t=0;document.querySelectorAll(".badge-price").forEach(e=>{let a=parseFloat(e.getAttribute("data-price")),n=parseInt(e.getAttribute("data-quantity"));isNaN(a)||(t+=a*n)}),e&&(t+=e),o(t)}function r(e=!1){!function e(t=!1){let a=api.fetchItems();if(!a&&t){s("messageArea","A problem occurred while loading file. Please make sure you are loading the correct inventory file.","danger",3);return}n(a)}(e);let t;t=api.fetchTitle()??"Inventory",document.getElementById("inventoryTitle").value=t;let a;a=api.fetchCurrency()??"$",document.getElementById("currencySymbolSelect").value=a,g(a)}function s(e,t,a,n){if("string"!=typeof t||"string"!=typeof e||0==e.length)return;if(0===t.length){document.getElementById(e).innerHTML="<br>";return}let l=`<div class="alert alert-${a} alert-dismissible fade show d-flex shadow py-2" role="alert">
        <i class="${"success"===a?"bi bi-check-circle":"bi bi-exclamation-triangle"} me-2"></i><span class="fw-bold mx-auto text-center">${t}</span>
        <button type="button" class="btn-close pt-1" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>`;document.getElementById(e).innerHTML=l,n&&setTimeout(()=>{document.getElementById(e).innerHTML="<br>"},1e3*parseInt(n))}function d(e){document.getElementById("itemFormHeader").classList.remove("bg-primary-subtle","bg-success-subtle","bg-warning-subtle"),document.getElementById("itemFormHeader").classList.add(`bg-${e}-subtle`)}function m(){let e=document.getElementById("addItemBtn");e&&e.remove(),document.getElementById("item-list").innerHTML+=`<div class="col" id="addItemBtn">
        <div class="card shadow h-100">
          <button class="btn btn-lg bg-body-tertiary text-primary h-100" title="Add Item" onclick="addItemMode();">
            <i class="bi bi-plus-square"></i>
          </button>
        </div>
      </div>`}function o(e){e?(document.getElementById("totalAmount").innerHTML=`<span class="currency-symbol">$</span>${c(e)}`,document.getElementById("totalArea").classList.remove("d-none")):(document.getElementById("totalAmount").innerHTML="",document.getElementById("totalArea").classList.add("d-none"))}function c(e){return e.toLocaleString("en-US",{minimumFractionDigits:2})}function g(e){document.querySelectorAll(".currency-symbol").forEach(t=>{t.innerHTML=e})}addEventListener("load",e=>{r(),window.matchMedia("(prefers-color-scheme: dark)").matches&&toggleTheme(),$("#item-list").sortable({items:".col:not('#addItemBtn')",opacity:.8,placeholder:"sortable-placeholder",tolerance:"pointer",stop:function(e,a){let n=a.item[0],l=api.fetchItems(),i=n.id,r=l.findIndex(e=>e.id.toString()===i);if(r>-1){let d=[...document.getElementById("item-list").querySelectorAll(".col")].indexOf(n);if(d===r)t?t--:(s("messageArea","If you are having issues scrolling on mobile, place your finger on an item's quantity box to scroll the page.","warning",8),t=4);else{let m=l.splice(r,1)[0];l.splice(d,0,m),api.updateItems(l),t=4}}else s("messageArea","Sorting error. Item not found.","danger",3)}})}),document.getElementById("itemForm").addEventListener("shown.bs.offcanvas",e=>{let t=document.getElementById("itemId").value;t||document.getElementById("itemName").focus();let a=bootstrap.Collapse.getInstance(document.getElementById("collapseOpt"));a&&a.show()}),document.getElementById("currencySymbolSelect").addEventListener("change",e=>{let t=e.target.value;g(t),api.editCurrency(t)}),document.getElementById("itemPrice").addEventListener("change",e=>{e.currentTarget.value=parseFloat(e.currentTarget.value).toFixed(2)}),window.clearData=()=>{document.getElementById("item-list").innerHTML="",localStorage.clear(),r();bootstrap.Modal.getInstance(document.getElementById("clearModal")).hide(),s("messageArea","Data cleared!","success",3)},window.loadFileListener=()=>{document.getElementById("fileInput").click()},window.loadFile=()=>{let t=document.getElementById("fileInput").files[0];if(t){let a=new FileReader;a.onload=t=>{let a=t.target.result;try{let n=JSON.parse(a);n.items?(s("messageArea",""),e.hide(),document.getElementById("item-list").innerHTML="",api.loadInventory(n),r(!0)):s("messageArea","Error loading file. Inventory data not found.","danger",3)}catch(l){console.error(l),s("messageArea","Error loading file. Could not read data.","danger",3)}},a.readAsText(t)}else s("messageArea","File not found.","danger",3)},window.saveFile=()=>{let e=api.fetchInventory();if(!e.items.length){s("messageArea","Save canceled. There are no items in the list.","danger",3);return}e.title||(e.title=document.getElementById("inventoryTitle").value),e.currency||(e.currency=document.getElementById("currencySymbolSelect").value);let t=new Blob([JSON.stringify(e)],{type:"text/plain"}),a=document.getElementById("downloadLink");a.href=URL.createObjectURL(t),a.download="inventory.txt",a.click()},window.sortItems=e=>{if(!api.fetchItems().length){s("messageArea","There are no items to sort.","danger",3);return}let t;switch(e){case"1":t=api.sortItemsByName(!0);break;case"2":t=api.sortItemsByType();break;case"3":t=api.sortItemsByType(!0);break;case"4":t=api.sortItemsByDate();break;case"5":t=api.sortItemsByDate(!0);case"6":t=api.sortItemsByQuantity();break;case"7":t=api.sortItemsByQuantity(!0);break;default:t=api.sortItemsByName()}document.getElementById("item-list").innerHTML="",n(t)},window.toggleTheme=()=>{let e=document.getElementById("themeBtn"),t=document.documentElement;t.hasAttribute("data-bs-theme")?(t.removeAttribute("data-bs-theme"),e.innerHTML='<i class="bi bi-moon-stars-fill mx-2"></i>Dark Mode'):(t.setAttribute("data-bs-theme","dark"),e.innerHTML='<i class="bi bi-brightness-high-fill mx-2"></i>Light Mode')},window.setTitle=e=>{e.value||(e.value="Inventory"),api.editTitle(e.value)},window.addItemMode=()=>{document.getElementById("itemOperation").innerHTML="Add",document.getElementById("itemId").value="",document.getElementById("itemName").value="",document.getElementById("itemType").value="",document.getElementById("itemColour").value="",document.getElementById("itemQuantity").value="",document.getElementById("itemPrice").value="",a.clear(),document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),d("success"),s("itemFormMessageArea",""),e.show()},window.updateItemMode=(t,n=!1)=>{var l,i,r,m;let o,c,g;l=t,i=n,(o=api.fetchItem(l)).id?(i&&(o.id=""),r=o,m=i,document.getElementById("itemOperation").innerHTML=m?"Duplicate":"Update",document.getElementById("itemId").value=r.id,document.getElementById("itemName").value=r.name,document.getElementById("itemType").value=r.type,document.getElementById("itemColour").value=r.colour,document.getElementById("itemQuantity").value=r.quantity,document.getElementById("itemPrice").value=0===r.price?"":parseFloat(r.price).toFixed(2),g=(c=new Date(r.date)).toLocaleString(),a.setDate(c),m?(document.getElementById("deleteItemBtn").classList.add("d-none"),document.getElementById("deleteItemBtn").removeAttribute("onclick"),d("warning")):(document.getElementById("deleteItemBtn").classList.remove("d-none"),document.getElementById("deleteItemBtn").setAttribute("onclick",`showDeleteModal(event, '${r.id}', '${r.name}', '${g}');`),d("primary")),s("itemFormMessageArea",""),e.show()):(console.error(l,api.fetchItems()),s("messageArea","Item not found.","danger",3))},window.addOrUpdateItem=t=>{var a,n,r,d,o,g,u,y,I,b,p,f,v,B,E,h,A,M,L,T;t.preventDefault();let w=parseInt(t.target.itemId.value),S=t.target.itemName.value.trim(),k=t.target.itemType.value.trim(),F=t.target.itemColour.value,H=t.target.itemDate.value,x=t.target.itemQuantity.value,D=parseInt(x),P=t.target.itemPrice.value,q=parseFloat(P),_=new Date(H);if(S){if(k){if(F){if(isNaN(D)&&""!==x){s("itemFormMessageArea","Please enter a valid quantity.","danger",3);return}if(H&&!_){s("itemFormMessageArea","Please enter a valid date.","danger",3);return}else if(P&&(isNaN(q)||q<0)){s("itemFormMessageArea","Please enter a valid price.","danger",3);return}}else{s("itemFormMessageArea","Please select a colour.","danger",3);return}}else{s("itemFormMessageArea","Please enter item type.","danger",3);return}}else{s("itemFormMessageArea","Please enter item name.","danger",3);return}let C=api.searchItems(S);if(C&&C.id!==w){s("itemFormMessageArea",`Item already exists and was added on <em>${new Date(C.date).toLocaleString()}</em>`,"danger",4);return}H||(_=new Date).setSeconds(0);let N=_.toISOString().split(".")[0]+"Z";if(D=""===x?1:D,q=""===P?0:q,isNaN(w)){let O;a=S,n=k,r=F,d=D,o=N,g=q,O=Date.now(),api.addItem(O,a,n,r,d,o,g)?(l(O,a,n,r,d,o,g),m(),i(),e.hide(),s("messageArea","Item successfully added!","success",3)):s("itemFormMessageArea","A problem occurred while adding item. Please try again later.","danger")}else{let Q,U;u=w,y=S,I=k,b=F,p=D,f=N,v=q,api.updateItem(u,y,I,b,p,f,v)?(B=u,E=y,h=I,A=b,M=p,L=f,T=v,Q=new Date(L).toLocaleString(),document.getElementById(`${B}-itemName`).innerHTML=E,document.getElementById(`${B}-itemType`).innerHTML=h,document.getElementById(`${B}-quantity`).value=M,document.getElementById(`${B}-itemDate`).innerHTML=Q,(U=document.getElementById(`${B}-itemPrice`)).setAttribute("data-price",T),U.setAttribute("data-quantity",M),U.innerHTML=`<span class="currency-symbol">$</span>${c(T)}`,T?U.classList.remove("d-none"):U.classList.add("d-none"),document.getElementById(`${B}-header`).style.backgroundColor=A,i(),e.hide(),s("messageArea","Item successfully updated!","success",3)):s("itemFormMessageArea","A problem occurred while updating item. Please try again later.","danger")}},window.addUpdateSave=()=>{document.getElementById("addUpdateForm").requestSubmit()},window.showDeleteModal=(e,t,a,n)=>{e.preventDefault(),document.getElementById("deleteModal").setAttribute("data-id",t),document.getElementById("deleteItemName").innerHTML=a,document.getElementById("deleteDateTime").innerHTML=n;bootstrap.Modal.getOrCreateInstance(document.getElementById("deleteModal")).show()},window.deleteItem=()=>{!function t(a){if(api.deleteItem(a)){document.getElementById(`${a}`).remove(),i();bootstrap.Modal.getInstance(document.getElementById("deleteModal")).hide(),e.hide(),s("messageArea","Item successfully deleted!","success",3)}else s("deleteModalMessageArea","A problem occurred while deleting item. Please try again later.","danger")}(document.getElementById("deleteModal").getAttribute("data-id"))}}();